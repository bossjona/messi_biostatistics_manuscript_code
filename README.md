# Mediation with External Summary Statistic Information (MESSI) Code Repository

## Simulation Code

The simulation code for the congenial simulation settings is housed in the simulations_correct folder, the simulation code for the incongenial simulation settings is housed in the simulations_incorrect_fixed folder, and the simulation code for the random simulation settings is housed in the simulations_incorrect_random folder. The implementations.R file contains required functions to run the simulation code. Here are the steps to re-run the simulations:

- Run simulation_code.R to generate the simulation output (note that arrayid in this script is assigned by the Slurm Workload Manager; this value will take 1-2000 for the 2000 simulation iterations).
- After the 2000 runs of simulation_code.R, run combine.R to aggregate and clean-up the simulation output.
- After combine.R is run, then run summarize_results_numerical_no_pen.R to generate the simulation results.
- After all of the simulations are run in all of the subfolders, run the following scripts to generate the figures and tables presenting the simulation results:
    - rmse_visualize_n2000_nde_estimation_unpenalized.R
    - rmse_visualize_n2000_nie_estimation_unpenalized.R
    - rmse_visualize_n200_nde_estimation_unpenalized.R
    - rmse_visualize_n200_nie_estimation_unpenalized.R
    - sim_results_n2000_nde_correct.R
    - sim_results_n2000_nie_correct.R
    - sim_results_n200_nde_correct.R
    - sim_results_n200_nie_correct.R

## Data Example Code

For the data example, data_example_function_eicosanoids_cyctochromep450_param_boot.R runs the code for the data examples and generates the Figure showing DE, IE, and TE estimation for the four different methods. Interval lengths are calculated in calculate_interval_lengths.Rmd.

## Simulated Data Example Code

The folder corresponding to the simulated data example code illustrates how to run the code for the data example on a simulated dataset. The simulated dataset, protect.all.exposures.simulate.csv, was generated by randomly generating samples from a multivariate normal distribution with mean and variance-covariance matrix estimated using the observed log-transformed exposure data, the observed log-transformed eicosanoid data, and final gestational age. As with the data example code, data_example_function_eicosanoids_cyctochromep450_param_boot.R runs the code for the simulated data example and generates the Figure showing DE, IE, and TE estimation for the four different methods. Interval lengths, point estimates, and confidence intervals are calculated/displayed in calculate_interval_lengths.Rmd.
